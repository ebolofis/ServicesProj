@using HitServicesCore.Models.SharedModels;
@using DevExtreme.AspNet.Mvc;
@using HitServicesCore.Models.SharedModels;
@using HitServicesCore.Models.Helpers;
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/js/ExportData/ExportData.js"></script>
<link rel="stylesheet" href="~/css/Plugins/Plugins.css">
<link rel="stylesheet" href="~/css/Services/services.css" />
<link rel="stylesheet" href="~/css/Configuration/configuration.css" />
<link rel="stylesheet" href="~/css/InitDB/initdb.css" />
<link rel="stylesheet" href="~/css/ExportData/exportdata.css" />
<div class="b1psb">
    <div class="custom-flex-column custom-flex-100 header">
        <h1 class="tac">Export Data</h1>


        <label style="display:none"></label>
        <div class="flex-container" style="margin-top: 25px;background: none;">
            <div class="flex-item flex-basis-50">
                <label for="scripts">Choose a Export Data  Service :</label>
                <select name="scripts" style="width:300px;" id="ExportData" onchange="selectCurrentScript(this)">
                </select>
                &nbsp;
                <button style="        border: 1px solid black;background: #00468b;color: white;height: 50px;width: 100px;" onclick="updateFile()">Update</button>
            </div>
            <div class="flex-item" style="        flex-basis:75%;">
                <div class="flex-item flex-basis-35">
                    <label>Create a new File</label>
                    &nbsp;
                    <button style="        background: green;width: 50px;border-radius: 15px;height: 35px;" onclick="showNewFileText()">+</button>
                    &nbsp;&nbsp;
                    <input type="text" id="newfiletext" style="visibility: hidden;width: 400px;" value="" />
                    <button style="        background: #00468b;color: white;height: 50px;width: 100px;" onclick="saveNewFile()">Save</button>
                </div>
            </div>
        </div>
        <section id="wrapper">
            <div class="content">
                <!-- Tab links -->
                <div class="tabs">
                    <button class="tablinks active" data-country="General"><p data-title="General">General</p></button>
                    <button class="tablinks" data-country="DBs"><p data-title="DBs">DBs</p></button>
                    <button class="tablinks" data-country="SQLScript"><p data-title="SQLScript">SQL Script</p></button>
                    <button class="tablinks" data-country="SQLParameters"><p data-title="SQLParameters">SQL Params</p></button>
                    <button class="tablinks" data-country="ExportToFile"><p data-title="ExportToFile">Export To File</p></button>
                    <button class="tablinks active" data-country="Xml"><p data-title="Xml">Xml</p></button>
                    <button class="tablinks" data-country="Json"><p data-title="Json">Json</p></button>
                    <button class="tablinks" data-country="Csv"><p data-title="Csv">Csv</p></button>
                    <button class="tablinks" data-country="Fixedlength"><p data-title="Fixedlength">Fixed length</p></button>
                    <button class="tablinks active" data-country="Html"><p data-title="Html">Html</p></button>
                    <button class="tablinks" data-country="ApiClient"><p data-title="ApiClient">Api Client</p></button>
                    <button class="tablinks" data-country="Pdf"><p data-title="Pdf">Pdf</p></button>
                    <button class="tablinks" data-country="SendEmail"><p data-title="SendEmail">Send Email</p></button>

                </div>

                <!-- Tab content -->
                <div class="wrapper_tabcontent">
                    <div id="General" class="tabcontent active">
                        <h3>General</h3>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis: 100%;height: 425px;">
                                <h1 style="color:black;font-weight:bolder">Description</h1>
                                <div id="classdescription" rows="17" cols="100" style="margin: 0px; height: 300px; width: 772px;" readonly>
                                    <h4><strong>Jod that call 'Export Data' Service:</strong></h4>
                                    <h5>Service gets data running an sql script and then exports the selected data <em> (to at least one File or/and to a Rest Server.</em></h5>
                                    <h5>
                                        he relaited SQL Script must return one or two Data Sets (select statements): <br />
                                        1st Data Set: Data to export to file or/and to Rest Server. <br />
                                        2nd Data Set: Updated values for the sql parameters (optional).
                                    </h5>
                                    <h5>It also returns the data to caller (see also SqlController.ExportData).</h5>
                                    <h5 style="color: #002868;font-weight:bold">EXAMPLE (1 Data Set) : </h5>
                                    <h5>
                                        <span style="color:darkgreen"> select </span>  TOP (10)  [kdnr],[name1],[name2],[outldate],[prof],[landkz]as lkz INTO #TempTable <br />
                                        <span style="color:darkgreen">FROM </span> [protel].[proteluser].[kunden]
                                    </h5>
                                    <h5 style="color: #002868; font-weight: bold">EXAMPLE (2 Data Sets) :</h5>
                                    <h5>
                                        &nbsp;  IF object_id('tempdb..#TempTable') is not null  drop table
                                        select  TOP (10)  [kdnr],[name1],[name2],[outldate],[prof],[landkz]as lkz INTO #TempTable FROM [protel].[proteluser].[kunden] where kdnr>@@Id <br />
                                        SELECT * from #TempTable                    -- <-- 1st Data Set <br />
                                         SELECT max(kdnr) as Id from #TempTable      -- <-- 2nd Data Set <br />
                                         drop table #TempTable
                                    </h5>
                                    <h5>
                                        In the example above the 2nd Data Set contains the updated value 'Id' for the SQLParameter @@Id (see SQL Script section)
                                    </h5>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label style="color:black;">serviceVersion : &nbsp;</label>
                                <label data-bind="text:ExportDataViewModel.serviceVersion()" id="serviceVersion"></label>
                            </div>
                        </div>
                    </div>

                    <div id="DBs" class="tabcontent">
                        <h3>DBs</h3>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label style="color:black;">Custom DB1</label>
                                <input type="password" id="db1" style="width: 32vw;" data-bind="value:ExportDataViewModel.custom1DB()" />
                                <i class="fas fa-eye" style="color:green;cursor:pointer;" onclick="ShowHideDb('db1')"></i>
                            </div>
                        </div>

                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label style="color:black;">Timeout in Sec</label>
                                <input type="text" id="timeout" style="width: 10vw;" data-bind="value:ExportDataViewModel.dbTimeout()" />
                                <select name="db" id="DB" onchange="selectCurrentDB(this)">
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="30">30</option>
                                    <option value="60">60</option>
                                    <option value="90">90</option>
                                    <option value="120">120</option>
                                    <option value="150">150</option>
                                    <option value="180">180</option>
                                    <option value="250">250</option>
                                    <option value="300">300</option>
                                    <option value="420">420</option>
                                    <option value="600">600</option>
                                    <option value="1200">1200</option>
                                    <option value="2000">2000</option>
                                    <option value="5000">5000</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div id="SQLScript" class="tabcontent">
                        <h3>SQL Script</h3>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <textarea style="position:sticky;" id="scriptbody" rows="22" cols="100" data-bind="value:ExportDataViewModel.sqlScript()" draggable="false">
                                </textarea>
                            </div>
                        </div>
                    </div>
                    <div id="SQLParameters" class="tabcontent">
                        <h3>SQL Params</h3>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <h3>Dynamic Add/delete row</h3>
                                <div class="col-md-10" style="margin-left: -15px">
                                    <div class="table-responsive">
                                        <table id="test-table" class="table table-condensed">
                                            <thead>
                                                <tr>
                                                    <th>Key</th>
                                                    <th>Value</th>
                                                </tr>
                                            </thead>
                                            <tbody id="test-body">
                                                <tr id="row0">
                                                    <td>
                                                        <input name='from_value0' type='text' class='form-control sqlparamskey' />
                                                    </td>
                                                    <td>
                                                        <input name='to_value0' type='text' class='form-control input-md sqlparamsvalue' />
                                                    </td>
                                                    <td>
                                                        <input class='delete-row btn btn-primary' type='button' value='Delete' />
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <input id='add-row' class='btn btn-primary' type='button' value='Add' />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="ExportToFile" class="tabcontent">
                        <h3>  File Export</h3>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <h3>Dynamic Add/delete row</h3>
                                <div class="col-md-10" style="margin-left: -15px">
                                    <div class="table-responsive">
                                        <table id="test-table" class="table table-condensed">
                                            <thead>
                                                <tr>
                                                    <th>Key</th>
                                                    <th>Value</th>
                                                </tr>
                                            </thead>
                                            <tbody id="test-body-export">
                                                <tr id="row0">
                                                    <td>
                                                        <input name='from_value0' type='text' class='form-control exporttofileparamskey' />
                                                    </td>
                                                    <td>
                                                        <input name='to_value0' type='text' class='form-control input-md exporttofileparamsvalue' />
                                                    </td>
                                                    <td>
                                                        <input class='delete-row btn btn-primary' type='button' value='Delete' />
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <input id='add-row-export' class='btn btn-primary' type='button' value='Add' />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex-container">
                            <label>Culture Info  &nbsp;</label>
                            <select name="db" id="DB" onchange="selectCultureInfo(this)">
                                <option value="en-US">en-Us</option>
                                <option value="en-GB">en-GB</option>
                                <option value="fr-FR">fr-FR</option>
                                <option value="de-DE">de-DE</option>
                                <option value="el-GR">el-GR</option>
                                <option value="es-ES">es-ES</option>
                                <option value="ru-RU">ru-RU</option>
                                <option value="mk-MK">mk-MK</option>
                                <option value="sq-AL">sq-AL</option>
                            </select>
                            <label>Selected:</label><input type="text" id="cultureinfo" style="width: 65px;" readonly data-bind="value:ExportDataViewModel.cultureInfo()" />
                        </div>
                        <div class="flex-container">
                            <label>Time Stamp &nbsp;</label>
                            <input type="text"  id="timestamp" data-bind="value:ExportDataViewModel.timeStamp()"/>
                        </div>
                    </div>
                    <div id="Xml" class="tabcontent">
                        <h3>Xml</h3>
                        <div class="flex-container">
                            <label>Xml File Path &nbsp;</label>
                            <input type="text" id="xmlFilePath" style="width:40vw;" data-bind="value:ExportDataViewModel.xmlFilePath()" />
                        </div>
                        <div class="flex-container">
                            <label>Root Element &nbsp;</label>
                            <input type="text" id="xmlRootElement" style="width:40vw;" data-bind="value:ExportDataViewModel.xmlRootElement()" />
                        </div>
                        <div class="flex-container">
                            <label>Xml Element &nbsp; &nbsp;</label>
                            <input type="text" id="xmlElement" style="width:40vw;" data-bind="value:ExportDataViewModel.xmlElement()" />
                        </div>
                    </div>
                    <div id="Json" class="tabcontent">
                        <h3>Json</h3>
                        <div class="flex-container">
                            <label>Json Path &nbsp;</label>
                            <input type="text" id="jsonFilePath" style="width:40vw;" data-bind="value:ExportDataViewModel.jsonFilePath()" />
                        </div>
                    </div>
                    <div id="Csv" class="tabcontent">
                        <h3>Csv</h3>
                        <div class="flex-container">
                            <label>Csv Path &nbsp;</label>
                            <input type="text" id="csvpath" style="width:40vw;"  data-bind="value:ExportDataViewModel.CsvFilePath()" />
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>File Header </label>
                                <!-- ko if: ExportDataViewModel.CsvFileHeader()==true-->
                                <input type="checkbox" value="" id="fileheader" data-bind="value:ExportDataViewModel.CsvFileHeader()" checked />
                                <!-- /ko -->
                                <!-- ko if: ExportDataViewModel.CsvFileHeader()==false-->
                                <input type="checkbox" value="" id="fileheader" data-bind="value:ExportDataViewModel.CsvFileHeader()" />
                                <!-- /ko -->
                            </div>
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>Csv  Delimiter </label>
                                <select name="db" id="csvdelim">
                                    <option value=":">:</option>
                                    <option value="Comma">Comma</option>
                                    <option value="Space">Space</option>
                                    <option value="Tab">Tab</option>
                                    <option value="-">-</option>
                                    <option value="@@">@@</option>
                                    <option value="#">#</option>
                                    <option value="$">$</option>
                                    <option value="^">^</option>
                                    <option value="~">~</option>
                                </select>
                                <label> Currently selected</label>
                                <label type="text" style="width:50px;text-align:center" data-bind="text: ExportDataViewModel.CsvDelimenter()" readonly />
                            </div>
                        </div>
                    </div>
                    <div id="Fixedlength" class="tabcontent">
                        <h3>Fixed length</h3>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>File Header </label>
                                <!-- ko if: ExportDataViewModel.fixedLenghtFileHeader()==true-->
                                <input type="checkbox" value="" id="fixedLenghtFileHeader" data-bind="value:ExportDataViewModel.fixedLenghtFileHeader()" checked />
                                <!-- /ko -->
                                <!-- ko if: ExportDataViewModel.fixedLenghtFileHeader()==false-->
                                <input type="checkbox" value="" id="fixedLenghtFileHeader" data-bind="value:ExportDataViewModel.fixedLenghtFileHeader()" />
                                <!-- /ko -->
                            </div>
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>Align Right </label>
                                <!-- ko if: ExportDataViewModel.fixedLenghtAlignRight()==true-->
                                <input type="checkbox" value="" id="fixedLenghtAlignRight" data-bind="value:ExportDataViewModel.fixedLenghtAlignRight()" checked />
                                <!-- /ko -->
                                <!-- ko if: ExportDataViewModel.fixedLenghtAlignRight()==false-->
                                <input type="checkbox" value="" id="fixedLenghtAlignRight" data-bind="value:ExportDataViewModel.fixedLenghtAlignRight()" />
                                <!-- /ko -->
                            </div>
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>Columns Length </label>
                                <select name="db"   onchange="selectFixedLength(this)">
                                    <option value="5">5</option>
                                    <option value="8">8</option>
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="100">100</option>

                                </select>
                                <input type="text" id="fixedLengths" data-bind="value:ExportDataViewModel.fixedLengths()"  readonly/>
                            </div>
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>Fixed  Length Path </label>
                                <input type="text" id="fixedLenghtFilePath"   data-bind="value:ExportDataViewModel.fixedLenghtFilePath()"  />
                            </div>
                        </div>
                    </div>
                    <div id="Html" class="tabcontent">
                        <h3>Html</h3>
                        <div class="flex-item " style="flex-basis:100%">
                            <label>Html Header </label>
                            <!-- ko if: ExportDataViewModel.htmlHeader()==true-->
                            <input type="checkbox" id="htmlHeader" data-bind="value:ExportDataViewModel.htmlHeader()" checked />
                            <!-- /ko -->
                            <!-- ko if: ExportDataViewModel.htmlHeader()==false-->
                            <input type="checkbox" id="htmlHeader" data-bind="value:ExportDataViewModel.htmlHeader()" />
                            <!-- /ko -->
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>Html Title </label>
                                <input type="text" id="htmlTitle" style="width:30vw;" data-bind="value:ExportDataViewModel.htmlTitle()" />
                            </div>
                        </div>

                        <div class="flex-container">

                            <div class="flex-item " style="flex-basis:100%">
                                <label for="CSS">CSS</label>
                                <textarea style="position:sticky;" id="htmlcss" name="CSS" rows="22" cols="100" data-bind="value:ExportDataViewModel.htmlcss()" draggable="false">
                                </textarea>
                            </div>
                        </div>
                    </div>
                    <div id="ApiClient" class="tabcontent">
                        <h3>Api Client</h3>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>Api Url </label>
                                <input type="text" id="restServerUrl" data-bind="value:ExportDataViewModel.restServerUrl()"/>
                            </div>
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>Authentication </label>
                                <input type="text" id="restServerAuthenticationHeader" data-bind="value:ExportDataViewModel.restServerAuthenticationHeader()" />
                            </div>
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>Authentication Type </label>
                                <input type="text" id="restServerAuthenticationType" readonly  data-bind="value:ExportDataViewModel.restServerAuthenticationType()"/>
                                <select name="db" onchange="selectAuthenticationType(this)">
                                    <option value="Anonymous">Anonymous</option>
                                    <option value="Basic">Basic</option>
                                    <option value="OAuth2">OAuth2</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>Http Method </label>
                                <input type="text" id="restServerHttpMethod" readonly data-bind="value:ExportDataViewModel.restServerHttpMethod()" />
                                <select name="db" onchange="selectHttpMethod(this)">
                                    <option value="GET">GET</option>
                                    <option value="POST">POST</option>
                                    <option value="PUT">PUT</option>
                                    <option value="DELETE">DELETE</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label>Media  Type </label>
                                <input type="text" id="restServerMediaType" readonly data-bind="value:ExportDataViewModel.restServerMediaType()" />
                                <select name="db" onchange="selectMediaType(this)">
                                    <option value="application/json">application/json</option>
                                    <option value="application/xml">application/xml</option>
                                </select>
                            </div>
                        </div>
                        <h3>Custom Headers</h3>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <h3>Dynamic Add/delete row</h3>
                                <div class="col-md-10" style="margin-left: -15px">
                                    <div class="table-responsive">
                                        <table id="test-table" class="table table-condensed">
                                            <thead>
                                                <tr>
                                                    <th>Key</th>
                                                    <th>Value</th>
                                                </tr>
                                            </thead>
                                            <tbody id="test-body-api">
                                                <tr id="row0">
                                                    <td>
                                                        <input name='from_value0' type='text' class='form-control apiparamskey' />
                                                    </td>
                                                    <td>
                                                        <input name='to_value0' type='text' class='form-control input-md apiparamsvalue' />
                                                    </td>
                                                    <td>
                                                        <input class='delete-row btn btn-primary' type='button' value='Delete' />
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <input id='add-row-api' class='btn btn-primary' type='button' value='Add' />
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div id="Pdf" class="tabcontent">
                        <h3>Pdf</h3>
                        <div class="flex-container">

                            <div class="flex-item " style="flex-basis:100%">
                                <label for="PDFCCS">CSS</label>
                                <textarea style="position:sticky;" id="pdfcss" name="CSS" rows="22" cols="100" data-bind="value:ExportDataViewModel.pdfcss()" draggable="false">
                                </textarea>
                            </div>
                        </div>
                    </div>
                    <div id="SendEmail" class="tabcontent">
                        <h3>Send Email</h3>

                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label style="color:black;margin-left:125px;">sendEmailTo</label>
                                &nbsp;
                                <input type="text" id="sendEmailTo" name="sendEmailTo" data-bind="value:ExportDataViewModel.sendEmailTo()">
                            </div>
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label style="color:black;">sendEmailOnSuccess</label>
                                &nbsp;
                                <!-- ko if: ExportDataViewModel.sendEmailOnSuccess()==true-->
                                <input type="checkbox" id="sendEmailOnSuccess" name="sendEmailOnSuccess" data-bind="value:ExportDataViewModel.sendEmailOnSuccess()" checked>
                                <!-- /ko -->
                                <!-- ko if: ExportDataViewModel.sendEmailOnSuccess()==false-->
                                <input type="checkbox" id="sendEmailOnSuccess" name="sendEmailOnSuccess" data-bind="value:ExportDataViewModel.sendEmailOnSuccess()">
                                <!-- /ko -->
                            </div>
                        </div>
                        <div class="flex-container">
                            <div class="flex-item " style="flex-basis:100%">
                                <label style="color:black;">sendEmailOnFailure</label>
                                &nbsp;
                                <!-- ko if: ExportDataViewModel.sendEmailOnFailure()==true-->
                                <input type="checkbox" id="sendEmailOnFailure" name="sendEmailOnFailure" data-bind="value:ExportDataViewModel.sendEmailOnFailure()" checked>
                                <!-- /ko -->
                                <!-- ko if: ExportDataViewModel.sendEmailOnFailure()==false-->
                                <input type="checkbox" id="sendEmailOnFailure" name="sendEmailOnFailure" data-bind="value:ExportDataViewModel.sendEmailOnFailure()">
                                <!-- /ko -->
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </section>
    </div>
</div>


<script>
    var ExportDataViewModel = new ExportDataViewModel();
</script>


